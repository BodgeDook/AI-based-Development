# CV-1-36: Инверсия маски

## Описание:

Этот скрипт выполняет удаление объектов определённого цвета (в примере — зелёные яблоки) на изображении, создавая маску, которая закрывает эти объекты, оставляя фон нетронутым. Программа демонстрирует обработку изображений с помощью OpenCV и сегментацию по цвету с возможностью гибкой настройки диапазонов HSV.

## Входные данные:

- `unmasked_green_object.jpg` — исходное изображение зелёного яблока.  
  (В скрипте используется синтетическое изображение.)

## Выходные данные:

- `masked_green_object.png` — результат работы программы: исходное изображение с применённой маской, где зелёное яблоко удалено/закрыто.

## Использование:

Для запуска программы выполните команду со следующими аргументами:

```bash
python make_green_object_mask.py --input_image unmasked_green_object.jpg --output_image masked_green_object.png \
			 	 --lower_hsv 30 40 60 25 30 0 \
				 --upper_hsv 85 255 255 95 255 100
```

--input_image — путь к исходному изображению.
--output_image — путь для сохранения результата (по умолчанию output.png).
(про HSV немного ниже)

Для справки об аргументах:

```bash
python make_green_object_mask.py --help
```

## Аргументы HSV

--lower_hsv и --upper_hsv задают один или несколько диапазонов HSV, которые определяют цвет объектов для маски.

Каждый диапазон задаётся тремя числами: H S V, где:

- H — оттенок (Hue) от 0 до 179
- S — насыщенность (Saturation) от 0 до 255
- V — яркость (Value) от 0 до 255

Пример с двумя диапазонами:

```bash
--lower_hsv 30 40 60 25 30 0
--upper_hsv 85 255 255 95 255 100
```

- Первый диапазон: lower = [30,40,60], upper = [85,255,255] -> захватывает светло-зелёные участки яблока.

- Второй диапазон: lower = [25,30,0], upper = [95,255,100] -> захватывает тёмно-зелёные участки яблока.

- Программа создаёт маску для каждого диапазона и объединяет их, что обеспечивает плавное выделение объекта.

Примечания:

- Можно задать любое количество диапазонов, просто добавляя H S V тройки подряд.

- Если указан только один диапазон, достаточно 3 чисел в --lower_hsv и 3 числа в --upper_hsv.

- Значения HSV можно подбирать экспериментально, чтобы лучше выделять объект на изображении.

## Как это работает:

Программа выполняет следующие шаги:

1. **Загрузка изображения и преобразование в HSV**  
   Загружается исходное изображение и преобразуется из BGR в HSV для удобной работы с цветами.

2. **Создание масок по диапазонам HSV**  
   Для каждого диапазона HSV создаётся бинарная маска, где белым цветом выделены пиксели нужного цвета.

3. **Объединение масок**  
   Все маски объединяются в одну, чтобы захватить все указанные диапазоны.

4. **Морфологическая обработка**  
   Применяется закрытие и дилатация для удаления шумов и заполнения небольших пустот.

5. **Заполнение контуров**  
   Контуры маски заполняются, чтобы объекты полностью закрывались белым цветом.

6. **Инвертирование маски и наложение на изображение**  
   Маска инвертируется и накладывается на исходное изображение, оставляя фон нетронутым.

7. **Сохранение результата**  
   Результат сохраняется в указанный файл (default = output.png).

## Документирование функций

Все функции скрипта содержат docstring, описывающий:

- Назначение функции
- Входные параметры (тип, назначение)
- Выходные значения
- Исключения, которые могут возникнуть при ошибках

Пример:

```bash
def create_color_mask(hsv, lower_hsv_list, upper_hsv_list):
    """
    Creates a combined mask from multiple HSV ranges.

    Args:
        hsv (np.ndarray): HSV image.
        lower_hsv_list (list of lists): List of lower HSV boundaries [[H,S,V], ...].
        upper_hsv_list (list of lists): List of upper HSV boundaries [[H,S,V], ...].

    Returns:
        mask (np.ndarray): Combined binary mask for all ranges.
    """
```

## Требования

Для работы скрипта необходимы следующие компоненты:

- **Python 3.x** — интерпретатор Python версии 3 и выше.  
- **OpenCV (`opencv-python`)** — библиотека для обработки изображений.  
- **NumPy** — библиотека для работы с массивами и математическими операциями.  

Установить зависимости можно командой:

```bash
pip install opencv-python numpy
```

Либо из файла requirements.txt с конкретными версиями библиотек:

```bash
pip install -r requirements.txt
```
